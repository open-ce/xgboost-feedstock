From 42987e0e69e1660cf59d8d2e9c5d391a5c7e37c2 Mon Sep 17 00:00:00 2001
From: Jason Furmanek <furmanek@us.ibm.com>
Date: Wed, 8 Sep 2021 12:45:15 -0400
Subject: [PATCH] Use central cuda capabilities

---
 cmake/Utils.cmake | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/cmake/Utils.cmake b/cmake/Utils.cmake
index 3d0973c7..b50caaa8 100644
--- a/cmake/Utils.cmake
+++ b/cmake/Utils.cmake
@@ -91,14 +91,19 @@ function(format_gencode_flags flags out)
   # Set up architecture flags
   if(NOT flags)
     if (CUDA_VERSION VERSION_GREATER_EQUAL "11.0")
-      set(flags "35;50;52;60;61;70;75;80")
+      #set(flags "35;50;52;60;61;70;75;80")
+      string(REPLACE "," ";" tmpflags "$ENV{cuda_levels}")
+      string(REPLACE "." "" flags "${tmpflags}")
     elseif(CUDA_VERSION VERSION_GREATER_EQUAL "10.0")
-      set(flags "35;50;52;60;61;70;75")
+      #set(flags "35;50;52;60;61;70;75")
+      string(REPLACE "," ";" tmpflags "$ENV{cuda_levels}")
+      string(REPLACE "." "" flags "${tmpflags}")
     elseif(CUDA_VERSION VERSION_GREATER_EQUAL "9.0")
       set(flags "35;50;52;60;61;70")
     else()
       set(flags "35;50;52;60;61")
     endif()
+    message(STATUS "Using Open-CE Centralized CUDA Capabilities: ${flags}")
   endif()
 
   if (CMAKE_VERSION VERSION_GREATER_EQUAL "3.18")
-- 
2.32.0

